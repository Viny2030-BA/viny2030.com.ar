<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viny 2030 ‚Äî Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --gold: #c9a84c; --bg: #080808; --surface: #111; --surface2: #191919; --border: #222; --text: #e8e0d0; --muted: #666; }
    body { background: var(--bg); color: var(--text); font-family: 'Barlow', sans-serif; padding: 40px 20px; }
    .header { text-align: center; margin-bottom: 40px; }
    .logo { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 700; letter-spacing: 8px; color: var(--gold); }
    .sub { font-size: 11px; letter-spacing: 4px; color: var(--muted); text-transform: uppercase; margin-top: 6px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; max-width: 800px; margin: 0 auto 40px; }
    .stat { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; }
    .stat-num { font-size: 32px; font-weight: 700; color: var(--gold); }
    .stat-label { font-size: 10px; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; margin-top: 4px; }
    .orders-table { max-width: 1000px; margin: 0 auto; }
    .table-title { font-family: 'Playfair Display', serif; font-size: 20px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { text-align: left; font-size: 10px; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; padding: 12px 16px; border-bottom: 1px solid var(--border); }
    td { padding: 14px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tr:hover td { background: var(--surface); }
    .code { font-family: monospace; color: var(--gold); font-size: 14px; font-weight: 700; letter-spacing: 2px; }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 10px; letter-spacing: 1px; text-transform: uppercase; font-weight: 600; }
    .badge.pending { background: rgba(201,168,76,0.1); color: var(--gold); border: 1px solid rgba(201,168,76,0.3); }
    .badge.paid { background: rgba(50,180,50,0.1); color: #6bc96b; border: 1px solid rgba(50,180,50,0.3); }
    .badge.cancelled { background: rgba(220,50,50,0.1); color: #e06060; border: 1px solid rgba(220,50,50,0.3); }
    .empty { text-align: center; padding: 60px; color: var(--muted); font-size: 14px; }
    .refresh-btn { background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Barlow', sans-serif; font-size: 12px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; transition: border-color 0.2s; }
    .refresh-btn:hover { border-color: var(--gold); }
    .nav-links { text-align: center; margin-top: 40px; }
    .nav-links a { font-size: 12px; letter-spacing: 2px; color: var(--muted); text-decoration: none; text-transform: uppercase; margin: 0 12px; transition: color 0.2s; }
    .nav-links a:hover { color: var(--gold); }
    select.status-sel { background: var(--surface2); border: 1px solid var(--border); color: var(--text); padding: 6px 10px; border-radius: 6px; font-size: 12px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Viny 2030</div>
    <div class="sub">Panel de Administraci√≥n</div>
  </div>

  <div class="stats">
    <div class="stat"><div class="stat-num" id="totalOrders">‚Äî</div><div class="stat-label">Total √ìrdenes</div></div>
    <div class="stat"><div class="stat-num" id="pendingOrders">‚Äî</div><div class="stat-label">Pendientes</div></div>
    <div class="stat"><div class="stat-num" id="paidOrders">‚Äî</div><div class="stat-label">Confirmadas</div></div>
    <div class="stat"><div class="stat-num" id="totalAmount">‚Äî</div><div class="stat-label">Total ARS</div></div>
  </div>

  <div class="orders-table">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
      <div class="table-title">√ìrdenes</div>
      <button class="refresh-btn" onclick="loadOrders()">‚Üª Actualizar</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Cliente</th>
          <th>Email</th>
          <th>Monto</th>
          <th>Idioma</th>
          <th>Estado</th>
          <th>Fecha</th>
        </tr>
      </thead>
      <tbody id="ordersBody">
        <tr><td colspan="7" class="empty">Cargando...</td></tr>
      </tbody>
    </table>
  </div>

  <div class="nav-links">
    <a href="/">Nuevo pedido</a>
    <a href="/comprobante">Subir comprobante</a>
  </div>

  <script>
    const LANG_FLAGS = { es: 'üá¶üá∑', en: 'üá¨üáß', fr: 'üá´üá∑', de: 'üá©üá™', it: 'üáÆüáπ' };

    async function loadOrders() {
      try {
        const res = await fetch('/api/orders');
        const orders = await res.json();

        const body = document.getElementById('ordersBody');
        if (!orders.length) {
          body.innerHTML = '<tr><td colspan="7" class="empty">No hay √≥rdenes a√∫n</td></tr>';
          updateStats([]);
          return;
        }

        body.innerHTML = orders.reverse().map(o => `
          <tr>
            <td><span class="code">${o.id}</span></td>
            <td>${o.name}</td>
            <td>${o.email}</td>
            <td>$${Number(o.amount).toLocaleString('es-AR')}</td>
            <td>${LANG_FLAGS[o.lang] || o.lang}</td>
            <td>
              <select class="status-sel" onchange="updateStatus('${o.id}', this.value)">
                <option value="pending" ${o.status==='pending'?'selected':''}>‚è≥ Pendiente</option>
                <option value="paid" ${o.status==='paid'?'selected':''}>‚úÖ Confirmado</option>
                <option value="cancelled" ${o.status==='cancelled'?'selected':''}>‚ùå Cancelado</option>
              </select>
            </td>
            <td>${new Date(o.createdAt).toLocaleString('es-AR', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'})}</td>
          </tr>
        `).join('');

        updateStats(orders);
      } catch (err) {
        document.getElementById('ordersBody').innerHTML = '<tr><td colspan="7" class="empty">Error al cargar √≥rdenes</td></tr>';
      }
    }

    function updateStats(orders) {
      document.getElementById('totalOrders').textContent = orders.length;
      document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
      document.getElementById('paidOrders').textContent = orders.filter(o => o.status === 'paid').length;
      const total = orders.filter(o => o.status === 'paid').reduce((s, o) => s + Number(o.amount), 0);
      document.getElementById('totalAmount').textContent = total ? '$' + total.toLocaleString('es-AR') : '$0';
    }

    async function updateStatus(code, status) {
      await fetch(`/api/orders/${code}/status`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status })
      });
      loadOrders();
    }

    loadOrders();
  </script>
</body>
</html>
